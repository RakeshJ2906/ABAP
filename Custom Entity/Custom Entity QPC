CLASS zcl_rj_ce_travel DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.
    INTERFACES if_rap_query_provider.
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_rj_ce_travel IMPLEMENTATION.
  METHOD if_rap_query_provider~select.
    DATA: lt_travel TYPE TABLE OF zrj_i_travel_ce.
    DATA count  TYPE int8.

    IF io_request->is_data_requested(  ).
      DATA(lv_top) = io_request->get_paging(  )->get_page_size(  ).
      IF lv_top < 0.
        lv_top = 1.
      ENDIF.

      DATA(lv_offset) = io_request->get_paging(  )->get_offset(  ).
      DATA(lv_sort) = io_request->get_sort_elements(  ).
      DATA(lv_entity_name) = io_request->get_entity_id(  ).

      IF lv_entity_name = 'ZRJ_I_TRAVEL_CE'.
        DATA(lv_conditions) = io_request->get_filter(  )->get_as_sql_string(  ).

        IF lv_conditions IS NOT INITIAL.
          SELECT travel_id, agency_id, customer_id, begin_date,
                 end_date, booking_fee, total_price, currency_code, description,
                 CASE overall_status
                 WHEN 'O' THEN 'Open'
                 WHEN 'A' THEN 'Accepted'
                 WHEN 'X' THEN 'Cancel'
                 END AS overall_status
             FROM /DMO/I_Travel_M
             WHERE (lv_conditions)
             ORDER BY travel_id, agency_id
             INTO TABLE @lt_travel
             OFFSET @lv_offset
             UP TO @lv_top ROWS.
        ELSE.
          SELECT travel_id, agency_id, customer_id, begin_date,
                 end_date, booking_fee, total_price, currency_code, description,
                 CASE overall_status
                 WHEN 'O' THEN 'Open'
                 WHEN 'A' THEN 'Accepted'
                 WHEN 'X' THEN 'Cancel'
                 END AS overall_status
            FROM /DMO/I_Travel_M
            ORDER BY travel_id, agency_id
            INTO TABLE @lt_travel
            OFFSET @lv_offset
            UP TO @lv_top ROWS.
        ENDIF.

        count = lines( lt_travel ).
        IF io_request->is_data_requested( ).
          io_response->set_data( lt_travel ).
        ENDIF.
        DATA(lv_total) = lv_offset + lv_top.
        IF io_request->is_total_numb_of_rec_requested( ).
          io_response->set_total_number_of_records( lines( lt_travel ) ).
        ENDIF.
      ENDIF.

    ENDIF.
  ENDMETHOD.

ENDCLASS.
